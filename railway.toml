[build]
builder = "nixpacks"
buildCommand = "npm install --production=false && npm run build"

[deploy]
startCommand = "npm run db:deploy && npm start"
healthcheckPath = "/api/healthcheck"
healthcheckTimeout = 100
restartPolicyType = "on_failure"
numReplicas = 1

[service]
internal_port = 8080
protocol = "http"
auto_stop_machines = false
auto_start_machines = true
min_machines_running = 1

[service.http]
force_https = true
keepalive_timeout = 120
proxy_connect_timeout = 5
proxy_read_timeout = 120
proxy_send_timeout = 120

[[service.ports]]
port = 8080
handlers = ["http", "websocket"]
force_https = true